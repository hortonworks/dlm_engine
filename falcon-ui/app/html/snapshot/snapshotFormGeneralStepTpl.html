<!--
/**
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
-->
<form id="snapshotFormGeneralStep" name="datasetForm" novalidate>

  <div class="col-xs-6">
    <label class="light">Name<mandatory-field></mandatory-field></label>
    <input type="text"
           name="nameInput"
           class="form-control"
           ng-model="snapshot.name"
           placeholder=""
           ng-disabled="editingMode"
           ng-pattern="validations.patterns.name"
           ng-required="true"
           check-name="{type:'snapshot', check:!editingMode}"/>
    </label>
  </div>

  <div class="col-xs-24">
    <label class="light">Tags</label>
  </div>

  <div class="col-xs-24">
    <div ng-repeat="tag in snapshot.tags">
      <div class="row dynamic-table-spacer">
        <div class="col-xs-4">
          <input type="text" class="form-control" ng-model="tag.key"
            validation-optional-message="{{validations.messages.key}}"
              ng-pattern="validations.patterns.alpha" ng-required="tag.value" placeholder="key"/>
        </div>
        <div class="col-xs-4">
          <input type="text" class="form-control" validation-optional-message="{{validations.messages.value}}"
              ng-model="tag.value"
              ng-pattern="validations.patterns.alpha" ng-required="tag.key" placeholder="value"/>
        </div>
        <div class="col-xs-4">
          <button type="button" class="btn btn-default btn-xs" ng-click="removeTag($index)" ng-disabled="xmlPreview.edit" ng-if="!$first || !$last">
            <span class="entypo minus"></span> delete
          </button>
          <button type="button" class="btn btn-default btn-xs" ng-click="addTag()" ng-disabled="xmlPreview.edit" ng-if="$last">
            <span class="entypo plus"></span> add tag
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xs-24"><label class="light">Type</label></div>
  <div class="col-xs-12 mt5">
    <div class="typeButtonsBox">
      <div class="col-xs-6">
        <span class="radio-inline">
          <input type="radio"
              name="mirrorType"
              ng-class="{active:snapshot.formType === 'HDFS'}"
              value="HDFS"
              ng-click="switchModel('HDFS')"/>
          File System
      </div>
      <div class="col-xs-10">
        <span class="radio-inline">
          <input type="radio"
              name="mirrorType"
              ng-class="{active:snapshot.formType === 'HIVE'}"
              value="HIVE"
              ng-click="switchModel('HIVE')"/>
          HIVE(catalog Storage)
      </div>
      <div class="col-xs-8">
        <span class="radio-inline">
          <input type="radio"
              name="mirrorType"
              ng-class="{active:snapshot.formType === 'snapshot'}"
              value="snapshot"
              ng-click="switchModel('snapshot')"/>
          Snapshot
      </div>
    </div>
  </div>

  <div class="col-xs-24 plr0px">
    <div class="col-xs-12 pl0px">
      <div class="col-xs-24 plr0px clusterBox">
        <h3>Source</h3>
        <div class="runJobOnBox">
          <input type="radio"
                 id="runJobOnSourceRadio"
                 ng-model="snapshot.runOn"
                 value="source"/>
          Run job here
        </div>

        <div class="col-xs-24">
          <div class="col-xs-6"><label class="light">Cluster<mandatory-field></mandatory-field></label></div>
          <div class="col-xs-10 mt10">
              <select ng-model="snapshot.source.cluster"
                  name="sourceClusterSelect"
                  class="form-control padding0">
                <option value="" disabled style='display:none;'>-Select cluster-</option>
                <option ng-selected="snapshot.source.cluster === cluster.name"
                        ng-repeat="cluster in clustersList"
                        value="{{cluster.name}}">
                  {{cluster.name}}
                </option>
              </select>
          </div>
        </div>
        <div class="col-xs-24">
          <div class="col-xs-6"><label class="light">Source Directory</label></div>
          <div class="col-xs-10 mt10">
            <input type="text"
                   name="sourceDirectoryPath"
                   ng-model="snapshot.source.directoryPath"
                   ng-pattern="validations.patterns.freeText"
                   class="form-control"
                   validation-optional-message="{{validations.messages.directoryPath}}" />
          </div>
        </div>
        <div class="col-xs-24">
          <div class="col-xs-6"><label class="light">Delete Snapshot After</label></div>
          <div class="col-xs-4 mt10">
            <input type="text"
                   name="sourceDeleteFrequency"
                   ng-model="snapshot.source.deleteFrequency.number"
                   ng-pattern="validations.patterns.twoDigits"
                   ng-keydown="validations.acceptOnlyNumber($event)"
                   class="form-control"
                   validation-optional-message="{{validations.messages.number}}" />
          </div>
          <div class="col-xs-8 mt10">
            <select ng-model="snapshot.source.deleteFrequency.unit" class="form-control padding0">
              <option selected value="minutes">minutes</option>
              <option value="hours">hours</option>
              <option value="days">days</option>
              <option value="months">months</option>
            </select>
          </div>
        </div>
        <div class="col-xs-24">
          <div class="col-xs-6"><label class="light">Keep Last</label></div>
          <div class="col-xs-4 mt10">
            <input type="text"
                   name="sourceSnapshotCount"
                   ng-model="snapshot.source.snapshotCount"
                   ng-pattern="validations.patterns.twoDigits"
                   ng-keydown="validations.acceptOnlyNumber($event)"
                   class="form-control"
                   validation-optional-message="{{validations.messages.number}}" />
          </div>
          <label class="light">snapshots</label>
        </div>
      </div>
    </div>

    <div class="col-xs-12 pl0px">
      <div class="col-xs-24 plr0px clusterBox">
        <h3>Target</h3>
        <div class="runJobOnBox">
          <input type="radio"
                 id="runJobOnTargetRadio"
                 ng-model="snapshot.runOn"
                 value="target" />
          Run job here
        </div>

        <div class="col-xs-24">
          <div class="col-xs-6">
            <label class="light">Cluster<mandatory-field></mandatory-field></label>
          </div>
          <div class="col-xs-10 mt10">
            <select ng-model="snapshot.target.cluster"
                  name="targetClusterSelect"
                  class="col-xs-24 form-control padding0"
                  id="targetClusterSelect">
              <option value="" disabled selected style='display:none;'>-Select cluster-</option>
              <option ng-selected="snapshot.target.cluster === clusterItem.name"
                      ng-repeat="clusterItem in clustersList"
                      value="{{clusterItem.name}}">
                {{clusterItem.name}}
              </option>
            </select>
          </div>
        </div>
        <div class="col-xs-24">
          <div class="col-xs-6"><label class="light">Source Directory</label></div>
          <div class="col-xs-10 mt10">
            <input type="text"
                   name="targetDirectoryPath"
                   ng-model="snapshot.target.directoryPath"
                   ng-pattern="validations.patterns.freeText"
                   class="form-control"
                   validation-optional-message="{{validations.messages.directoryPath}}" />
          </div>
        </div>
        <div class="col-xs-24">
          <div class="col-xs-6"><label class="light">Delete Snapshot After</label></div>
          <div class="col-xs-4 mt10">
            <input type="text"
                   name="targetDeleteFrequency"
                   ng-model="snapshot.target.deleteFrequency.number"
                   ng-pattern="validations.patterns.twoDigits"
                   ng-keydown="validations.acceptOnlyNumber($event)"
                   class="form-control"
                   validation-optional-message="{{validations.messages.number}}" />
          </div>
          <div class="col-xs-8 mt10">
            <select ng-model="snapshot.target.deleteFrequency.unit" class="form-control padding0">
              <option selected value="minutes">minutes</option>
              <option value="hours">hours</option>
              <option value="days">days</option>
              <option value="months">months</option>
            </select>
          </div>
        </div>
        <div class="col-xs-24">
          <div class="col-xs-6"><label class="light">Keep Last</label></div>
          <div class="col-xs-4 mt10">
            <input type="text"
                   name="targetSnapshotCount"
                   ng-model="snapshot.target.snapshotCount"
                   ng-pattern="validations.patterns.twoDigits"
                   ng-keydown="validations.acceptOnlyNumber($event)"
                   class="form-control"
                   validation-optional-message="{{validations.messages.number}}" />
          </div>
          <label class="light">snapshots</label>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xs-12 frequencyBox plr0px">
    <div class="col-xs-24">
      <label class="light">Frequency Every</label>
    </div>
    <div class="col-xs-24 plr0px">
      <div class="col-xs-8">
        <input type="text"
               name="frequencyEveryInput"
               ng-model="snapshot.frequency.number"
               ng-pattern="validations.patterns.twoDigits"
               ng-keydown="validations.acceptOnlyNumber($event)"
               class="form-control"
               validation-optional-message="{{validations.messages.number}}" />
      </div>
      <div class="col-xs-8">
        <select ng-model="snapshot.frequency.unit" class="form-control padding0">
          <option selected value="minutes">minutes</option>
          <option value="hours">hours</option>
          <option value="days">days</option>
          <option value="months">months</option>
        </select>
      </div>
    </div>

    <div class="col-xs-24">
      <label class="light">Timezone</label>
    </div>
    <div class="col-xs-24">
      <time-zone-select ng-model="snapshot.validity.timezone"></time-zone-select>
    </div>
  </div>

  <div class="col-xs-12">
    <div class="col-xs-24">
      <label class="light">Send alerts to</label>
    </div>
    <div class="col-xs-24 alertsBox plr0px">
      <div class="emailBox">
        <div class="col-xs-16">
          <input class="form-control"
                 name="emailAlertInput"
                 ng-model="snapshot.alert.email"
                 type="text"
                 placeholder="Email"
                 ng-pattern="validations.patterns.email"
                 validation-optional-message="{{validations.messages.email}}">
        </div>
      </div>
      <div class="addAlertBox col-xs-3">
        <button class="btn btn-default btn-xs"
                ng-disabled="!snapshot.alert.email"
                type="button"
                ng-click="addAlert()">
          <span class="glyphicon glyphicon-plus"></span>add alert
        </button>
      </div>
  </div>

    <div class="col-xs-24 emailArrayRow mt10" ng-repeat="email in snapshot.alerts">
      <span class="col-xs-16">{{email}}</span>
      <div class="col-xs-3"><button class="btn btn-default btn-xs"
              type="button"
              ng-click="removeAlert()">
        <span class="glyphicon glyphicon-minus"></span> delete
      </button></div>
    </div>
  </div>


  <div class="col-xs-24 pb15px mt35">
    <div class="pull-right">
      <a class="btn cnclBtn" ui-sref="main">
        CANCEL
      </a>
      <button class="btn nextBtn"
            ng-disabled="buttonSpinners.show"
            ng-click="goNext(datasetForm.$invalid)" scroll-to-error>
      NEXT <img src="css/img/ajax-loader.gif" ng-if="buttonSpinners.show" />
      </button>
    </div>
  </div>

</form>
