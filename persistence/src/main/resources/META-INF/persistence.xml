<?xml version="1.0" encoding="UTF-8"?>
<!--
    Copyright  (c) 2016-2017, Hortonworks Inc.  All rights reserved.

    Except as expressly permitted in a written agreement between you or your
    company and Hortonworks, Inc. or an authorized affiliate or partner
    thereof, any use, reproduction, modification, redistribution, sharing,
    lending or other exploitation of all or any part of the contents of this
    software is strictly prohibited.
-->
<persistence xmlns="http://java.sun.com/xml/ns/persistence"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             version="1.0">

    <persistence-unit name="beacon-hsqldb" transaction-type="RESOURCE_LOCAL">
        <provider>org.apache.openjpa.persistence.PersistenceProviderImpl</provider>

        <class>com.hortonworks.beacon.store.bean.ClusterBean</class>
        <class>com.hortonworks.beacon.store.bean.ClusterPairBean</class>
        <class>com.hortonworks.beacon.store.bean.ClusterPropertiesBean</class>
        <class>com.hortonworks.beacon.store.bean.PolicyInstanceBean</class>
        <class>com.hortonworks.beacon.store.bean.PolicyBean</class>
        <class>com.hortonworks.beacon.store.bean.PolicyPropertiesBean</class>
        <class>com.hortonworks.beacon.store.bean.InstanceJobBean</class>
        <class>com.hortonworks.beacon.store.bean.EventBean</class>

        <properties>
            <property name="openjpa.ConnectionDriverName" value="org.apache.commons.dbcp.BasicDataSource"/>

            <property name="openjpa.ConnectionProperties" value="**INVALID**"/> <!--Set by StoreService at init time -->

            <property name="openjpa.MetaDataFactory"
                      value="jpa(Types=
                      com.hortonworks.beacon.store.bean.ClusterBean
                      com.hortonworks.beacon.store.bean.ClusterPairBean
                      com.hortonworks.beacon.store.bean.ClusterPropertiesBean
                      com.hortonworks.beacon.store.bean.PolicyInstanceBean;
                      com.hortonworks.beacon.store.bean.PolicyPropertiesBean;
                      com.hortonworks.beacon.store.bean.PolicyBean;
                      com.hortonworks.beacon.store.bean.InstanceJobBean;
                      com.hortonworks.beacon.store.bean.EventBean)"></property>

            <property name="openjpa.DetachState" value="fetch-groups(DetachedStateField=true)"/>
            <property name="openjpa.LockManager" value="pessimistic"/>
            <property name="openjpa.ReadLockLevel" value="read"/>
            <property name="openjpa.WriteLockLevel" value="write"/>
            <property name="openjpa.jdbc.TransactionIsolation" value="read-committed"/> <!--CUSTOM-->
            <property name="openjpa.jdbc.DBDictionary" value="UseGetBytesForBlobs=true"/>
            <property name="openjpa.jdbc.DBDictionary" value="UseSetBytesForBlobs=true"/>
            <property name="openjpa.jdbc.DBDictionary" value="BlobBufferSize=500000"/>
            <property name="openjpa.jdbc.DBDictionary" value="batchLimit=50"/>
            <property name="openjpa.RuntimeUnenhancedClasses" value="unsupported"/>
            <property name="openjpa.Log" value="log4j"/>
        </properties>
    </persistence-unit>

    <persistence-unit name="beacon-mysql" transaction-type="RESOURCE_LOCAL">
        <provider>org.apache.openjpa.persistence.PersistenceProviderImpl</provider>

        <class>com.hortonworks.beacon.store.bean.ClusterBean</class>
        <class>com.hortonworks.beacon.store.bean.ClusterPairBean</class>
        <class>com.hortonworks.beacon.store.bean.ClusterPropertiesBean</class>
        <class>com.hortonworks.beacon.store.bean.PolicyInstanceBean</class>
        <class>com.hortonworks.beacon.store.bean.PolicyBean</class>
        <class>com.hortonworks.beacon.store.bean.PolicyPropertiesBean</class>
        <class>com.hortonworks.beacon.store.bean.InstanceJobBean</class>
        <class>com.hortonworks.beacon.store.bean.EventBean</class>

        <properties>
            <property name="openjpa.ConnectionDriverName" value="org.apache.commons.dbcp.BasicDataSource"/>

            <property name="openjpa.ConnectionProperties" value="**INVALID**"/> <!--Set by StoreService at init time -->

            <property name="openjpa.MetaDataFactory"
                      value="jpa(Types=
                      com.hortonworks.beacon.store.bean.ClusterBean
                      com.hortonworks.beacon.store.bean.ClusterPairBean
                      com.hortonworks.beacon.store.bean.ClusterPropertiesBean
                      com.hortonworks.beacon.store.bean.PolicyInstanceBean;
                      com.hortonworks.beacon.store.bean.PolicyPropertiesBean;
                      com.hortonworks.beacon.store.bean.PolicyBean;
                      com.hortonworks.beacon.store.bean.InstanceJobBean;
                      com.hortonworks.beacon.store.bean.EventBean)"></property>

            <property name="openjpa.DetachState" value="fetch-groups(DetachedStateField=true)"/>
            <property name="openjpa.LockManager" value="pessimistic"/>
            <property name="openjpa.ReadLockLevel" value="read"/>
            <property name="openjpa.WriteLockLevel" value="write"/>
            <property name="openjpa.jdbc.TransactionIsolation" value="repeatable-read"/> <!--CUSTOM-->
            <property name="openjpa.jdbc.DBDictionary" value="UseGetBytesForBlobs=true"/>
            <property name="openjpa.jdbc.DBDictionary" value="UseSetBytesForBlobs=true"/>
            <property name="openjpa.jdbc.DBDictionary" value="BlobBufferSize=500000"/>
            <property name="openjpa.jdbc.DBDictionary" value="batchLimit=50"/>
            <property name="openjpa.jdbc.DBDictionary" value="ClobTypeName=MEDIUMTEXT"/>
            <property name="openjpa.jdbc.DBDictionary" value="BlobTypeName=MEDIUMBLOB"/>
            <property name="openjpa.RuntimeUnenhancedClasses" value="unsupported"/>
            <property name="openjpa.Log" value="log4j"/>
        </properties>
    </persistence-unit>

    <persistence-unit name="beacon-postgresql" transaction-type="RESOURCE_LOCAL">
        <provider>org.apache.openjpa.persistence.PersistenceProviderImpl</provider>

        <class>com.hortonworks.beacon.store.bean.ClusterBean</class>
        <class>com.hortonworks.beacon.store.bean.ClusterPairBean</class>
        <class>com.hortonworks.beacon.store.bean.ClusterPropertiesBean</class>
        <class>com.hortonworks.beacon.store.bean.PolicyInstanceBean</class>
        <class>com.hortonworks.beacon.store.bean.PolicyBean</class>
        <class>com.hortonworks.beacon.store.bean.PolicyPropertiesBean</class>
        <class>com.hortonworks.beacon.store.bean.InstanceJobBean</class>
        <class>com.hortonworks.beacon.store.bean.EventBean</class>

        <properties>
            <property name="openjpa.ConnectionDriverName" value="org.apache.commons.dbcp.BasicDataSource"/>

            <property name="openjpa.ConnectionProperties" value="**INVALID**"/> <!--Set by StoreService at init time -->

            <property name="openjpa.MetaDataFactory"
                      value="jpa(Types=
                      com.hortonworks.beacon.store.bean.ClusterBean
                      com.hortonworks.beacon.store.bean.ClusterPairBean
                      com.hortonworks.beacon.store.bean.ClusterPropertiesBean
                      com.hortonworks.beacon.store.bean.PolicyInstanceBean;
                      com.hortonworks.beacon.store.bean.PolicyPropertiesBean;
                      com.hortonworks.beacon.store.bean.PolicyBean;
                      com.hortonworks.beacon.store.bean.InstanceJobBean;
                      com.hortonworks.beacon.store.bean.EventBean)"></property>

            <property name="openjpa.DetachState" value="fetch-groups(DetachedStateField=true)"/>
            <property name="openjpa.LockManager" value="pessimistic"/>
            <property name="openjpa.ReadLockLevel" value="read"/>
            <property name="openjpa.WriteLockLevel" value="write"/>
            <property name="openjpa.jdbc.TransactionIsolation" value="repeatable-read"/> <!--CUSTOM-->
            <property name="openjpa.jdbc.DBDictionary" value="UseGetBytesForBlobs=true"/>
            <property name="openjpa.jdbc.DBDictionary" value="UseSetBytesForBlobs=true"/>
            <property name="openjpa.jdbc.DBDictionary" value="BlobBufferSize=500000"/>
            <property name="openjpa.jdbc.DBDictionary" value="batchLimit=50"/>
            <property name="openjpa.jdbc.DBDictionary" value="ClobTypeName=MEDIUMTEXT"/>
            <property name="openjpa.jdbc.DBDictionary" value="BlobTypeName=MEDIUMBLOB"/>
            <property name="openjpa.RuntimeUnenhancedClasses" value="unsupported"/>
            <property name="openjpa.Log" value="log4j"/>
        </properties>
    </persistence-unit>

    <persistence-unit name="beacon-derby" transaction-type="RESOURCE_LOCAL">
        <provider>org.apache.openjpa.persistence.PersistenceProviderImpl</provider>

        <class>com.hortonworks.beacon.store.bean.ClusterBean</class>
        <class>com.hortonworks.beacon.store.bean.ClusterPairBean</class>
        <class>com.hortonworks.beacon.store.bean.ClusterPropertiesBean</class>
        <class>com.hortonworks.beacon.store.bean.PolicyInstanceBean</class>
        <class>com.hortonworks.beacon.store.bean.PolicyBean</class>
        <class>com.hortonworks.beacon.store.bean.PolicyPropertiesBean</class>
        <class>com.hortonworks.beacon.store.bean.InstanceJobBean</class>
        <class>com.hortonworks.beacon.store.bean.EventBean</class>

        <properties>
            <property name="openjpa.ConnectionDriverName" value="org.apache.commons.dbcp.BasicDataSource"/>

            <property name="openjpa.ConnectionProperties" value="**INVALID**"/> <!--Set by StoreService at init time -->

            <property name="openjpa.MetaDataFactory"
                      value="jpa(Types=
                      com.hortonworks.beacon.store.bean.ClusterBean
                      com.hortonworks.beacon.store.bean.ClusterPairBean
                      com.hortonworks.beacon.store.bean.ClusterPropertiesBean
                      com.hortonworks.beacon.store.bean.PolicyInstanceBean;
                      com.hortonworks.beacon.store.bean.PolicyPropertiesBean;
                      com.hortonworks.beacon.store.bean.PolicyBean;
                      com.hortonworks.beacon.store.bean.InstanceJobBean;
                      com.hortonworks.beacon.store.bean.EventBean)"></property>

            <property name="openjpa.DetachState" value="fetch-groups(DetachedStateField=true)"/>
            <property name="openjpa.LockManager" value="pessimistic"/>
            <property name="openjpa.ReadLockLevel" value="read"/>
            <property name="openjpa.WriteLockLevel" value="write"/>
            <property name="openjpa.jdbc.TransactionIsolation" value="read-committed"/> <!--CUSTOM-->
            <property name="openjpa.jdbc.DBDictionary" value="UseGetBytesForBlobs=true"/>
            <property name="openjpa.jdbc.DBDictionary" value="UseSetBytesForBlobs=true"/>
            <property name="openjpa.jdbc.DBDictionary" value="BlobBufferSize=500000"/>
            <property name="openjpa.jdbc.DBDictionary" value="batchLimit=50"/>
            <property name="openjpa.jdbc.DBDictionary" value="TimestampTypeName=TIMESTAMP"/>
            <property name="openjpa.RuntimeUnenhancedClasses" value="unsupported"/>
            <property name="openjpa.Log" value="log4j"/>
        </properties>
    </persistence-unit>
</persistence>
